<!DOCTYPE html>
<html>
  <head>
    <title>Geographic Data Science in R using bcmaps</title>
    <meta charset="utf-8">
    <meta name="author" content="Andy Teucher" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/leaflet/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet/leaflet.js"></script>
    <link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
    <script src="libs/Proj4Leaflet/proj4-compressed.js"></script>
    <script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding/leaflet.js"></script>
    <script src="libs/leaflet-providers/leaflet-providers.js"></script>
    <script src="libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
    <link href="libs/HomeButton/home-button.css" rel="stylesheet" />
    <script src="libs/HomeButton/home-button.js"></script>
    <script src="libs/HomeButton/easy-button-src.min.js"></script>
    <link href="libs/PopupTable/popup.css" rel="stylesheet" />
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="css/my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Geographic Data Science in R using bcmaps
## bcgov useR Day 2018
### Andy Teucher
### 2018/09/11

---





background-image: url(img/ArcGIS_logo.png)

???

Start by asking:
- Who does some spatial work - in any software, ArcGIS, R, or anything else?
- Who does some spatial work in R?
- I'm going to try to convince you 
  - why you would want to do spatial work in R
  - that it's not that hard
  - highlight a few key packages, including the 'bcmaps' package that we've made

---

# Data Science
.center[![](img/data-science-cycle.png)]

.footnote[Wickham and Grolemund: [R for Data Science](http://r4ds.had.co.nz/)]

???

- hyped word, lots of definities out there
- To me - it's data analysis but inclusive of all steps of the data cycle, with a greater emphasis on programming.
- Spatial analysis can easily be fit into this framework, another side of the same coin.

---

# Geographical Data Science
.center[![](img/data-science-cycle.png)]

.footnote[Wickham and Grolemund: [R for Data Science](http://r4ds.had.co.nz/)]

???

- movement labelled Geographical Data Science (GDS). Combines ‘data science’ with GIS.
- focus on reproducibility and programming interface

---

### .center[Geographic Information Systems (GIS)&lt;/br&gt;vs&lt;/br&gt;Geographic Data Science (GDS)&lt;sup&gt;1&lt;/sup&gt;]

.middle[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Attribute &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; GIS &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; GDS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Home disciplines &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Geography &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Geography, Computing, Statistics &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Software focus &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Graphical User Interface &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Code &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Reproducibility &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Minimal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Maximal &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.footnote[
[1] Lovelace, Nowosad, and Muenchow: Geocomputation with R ([Table 1.1](https://geocompr.robinlovelace.net/intro.html#tab:gdsl))
]

???

Why R for spatial?

- reading, writing and manipulating spatial data; making static and interactive maps; and spatial statistics and modelling

- Ability to seamlessly switch between spatial and non-spatial data processing, modeling and visualization tasks, 

- and create a fully reproducible workflow combining all these tasks

---
class: inverse, middle, center
![size400](https://github.com/edzer/rstudio_conf/raw/master/animation.gif)

???

- The main package for doing spatial analysis in R is `sf`
- Stands for 'simple features', a standard way representing geographic features (points, lines, polygons etc) and their attributes.
 - can read and write almost any spatial format
 - Can perform a huge array of spatial operations

---
class: middle

.left-column[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
# sp 

# rgdal

# rgeos
]

.right-column[
![size700](img/to_sf.png)
]

---

background-image: url(img/databc-ski-resorts.png)

---
### Read data with `st_read()` or `read_sf()`


```r
library(sf)
ski_resorts &lt;- read_sf("data/GSR_SKI_RESORTS_SV.geojson")
ski_resorts
```

&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;## Simple feature collection with 38 features and 2 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -128.9534 ymin: 49.06925 xmax: -114.938 ymax: 56.00973
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## &lt;span style='color: #555555;'&gt;# A tibble: 38 x 3&lt;/span&gt;&lt;span&gt;
##    FACILITY_NAME       MAILING_ADDRESS                            geometry
##    &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;chr&amp;gt;&lt;/span&gt;&lt;span&gt;               &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;chr&amp;gt;&lt;/span&gt;&lt;span&gt;                                   &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;POINT [°]&amp;gt;&lt;/span&gt;&lt;span&gt;
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 1&lt;/span&gt;&lt;span&gt; Clearwater Ski Hill 566 Dunn Lake Rd, Clearwat…    (-120.0258 51.63682)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 2&lt;/span&gt;&lt;span&gt; Cypress Bowl        6000 Cypress Bowl Rd, West…    (-123.2022 49.39569)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 3&lt;/span&gt;&lt;span&gt; Tabor Mountain Ski… 17875 Prince George Hwy 16…     (-122.4531 53.9432)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 4&lt;/span&gt;&lt;span&gt; Blackcomb           4545 Blackcomb Way, Whistl…    (-122.9486 50.11492)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 5&lt;/span&gt;&lt;span&gt; Crystal Mountain R… Powder King, BC                (-119.7106 49.88107)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 6&lt;/span&gt;&lt;span&gt; Kimberley Ski &amp;amp; Su… Kimberley, BC                  (-116.0048 49.68836)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 7&lt;/span&gt;&lt;span&gt; Shames Mountain     4544 Lakelse Ave, Terrace,…    (-128.9534 54.48447)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 8&lt;/span&gt;&lt;span&gt; Wapiti Ski Club     1000 Natal Rd, Elkford, BC      (-114.938 50.02169)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 9&lt;/span&gt;&lt;span&gt; Red Mountain Resort 4300 Red Mountain Rd, Ross…    (-117.8194 49.10238)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt;10&lt;/span&gt;&lt;span&gt; Big White Ski Reso… 5340 Big White Rd, Big Whi…    (-118.9286 49.72667)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 28 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;

???

- read_sf is clever - reads many many formats without having to do a whole bunch of magical incantations.
- Read in geojson file - have a look. Looks like a data.frame, but some special
stuff.
- Each row has a geometry associated with it (in this case a point)
- Metadata at the top - what type it is (POINT), the bounding box, and the projection

---
## plotting `sf` objects


```r
plot(ski_resorts)
```

&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

???

Plotting - built-in in sf
- kind of annoying, not very pretty
---
## plotting `sf` objects


```r
plot(st_geometry(ski_resorts))
```

&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

???

If only interested in plotting geometry(not attributes), use 
st_geometry

---
## plotting `sf` objects with **ggplot2**


```r
library(ggplot2)
ggplot(ski_resorts) + 
*  geom_sf() 
```

&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

??? 

Plotting even better with ggplot2
- special geom - geom_sf in latest version

---
## Interactive exploration with **mapview**


```r
library(mapview)
mapview(ski_resorts)
```

<div id="htmlwidget-1fcd24bfeb35a476c7fd" style="width:504px;height:432px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1fcd24bfeb35a476c7fd">{"x":{"options":{"minZoom":1,"maxZoom":100,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",1,"CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter",2,"CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",3,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",4,"Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenTopoMap",5,"OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[51.6368172638762,49.3956905330016,53.9431981770786,50.1149183642846,49.8810731855604,49.688361948096,54.4844724965179,50.0216850430959,49.1023785870115,49.726672765562,49.1863971448958,49.3653299651137,49.4429452196326,50.1134380937012,56.0097333775109,49.3904156627442,49.7415107195477,53.0660023350521,50.3387640705623,49.3721144108832,54.7686191742132,50.2187059427426,50.4572978477449,49.1092525576259,49.3801114880297,49.1528266417026,54.517227521888,49.4628443688479,50.14546384154,53.9009836093091,49.0692464520814,50.9592023151236,51.9047838984096,50.8775256326628,50.7230742747141,50.359030896337,51.2973742849023,55.3655269632642],[-120.025825419739,-123.202182333287,-122.453127000602,-122.948620952773,-119.710569147678,-116.00477433401,-128.95336359609,-114.938036290627,-117.819389750476,-118.928632610003,-117.301527755366,-122.94821295066,-117.145392277522,-122.954547708408,-122.170470231106,-119.904731613232,-125.303917527837,-121.942004948828,-115.826554756081,-123.098976496023,-127.279661715799,-126.352101762511,-116.238668577796,-118.585763182551,-121.935436563192,-119.235784966509,-124.209758580418,-115.087237454678,-117.614379292416,-121.883973435952,-120.91592709566,-118.164236820248,-121.262287422437,-119.91185992916,-120.138992026997,-119.056996649351,-117.045175360961,-122.609943033091],6,null,"ski_resorts",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":2,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>1&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Clearwater Ski Hill&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>566 Dunn Lake Rd, Clearwater, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>2&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Cypress Bowl&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>6000 Cypress Bowl Rd, West Vancouver, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>3&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Tabor Mountain Ski Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>17875 Prince George Hwy 16 E, Ferndale-Tabor, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>4&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Blackcomb&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>4545 Blackcomb Way, Whistler, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>5&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Crystal Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>Powder King, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>6&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Kimberley Ski & Summer Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>Kimberley, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>7&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Shames Mountain&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>4544 Lakelse Ave, Terrace, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>8&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Wapiti Ski Club&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>1000 Natal Rd, Elkford, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>9&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Red Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>4300 Red Mountain Rd, Rossland, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>10&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Big White Ski Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>5340 Big White Rd, Big White, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>11&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Salmo Ski Hill&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>499 Salmo Ski Hill Rd, Salmo, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>12&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Mount Seymour&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>1700 Mt Seymour Rd, North Vancouver, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>13&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Whitewater Ski Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>Whitewater Ski Hill Rd, Nelson, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>14&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Whistler Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>4545 Blackcomb Way, Whistler, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>15&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Hudson's Hope - Portage Mopuntain&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>22135 Canyon Dr, Hudsons Hope, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>16&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Apex Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>1000 Strayhorse Rd, Apex, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>17&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Mt Washington&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>1 Strathcona Pky, Mt Washington, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>18&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Troll Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>7271 Barkerville Hwy, Cottonwood, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>19&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Fairmont Hot Springs Ski Hill&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>5225 Fairmont Resort Rd, Fairmont Hot Springs, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>20&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Grouse Mountain&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>6400 Nancy Greene Way, North Vancouver, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>21&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Hudson Bay Mountain&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>339 Prairie Rd, Smithers, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>22&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Mount Cain Alpine Park&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>6450 Chatham Ave, Port Hardy, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>23&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Panorama Mountain Village&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>1921 Panorama Dr, Panorama, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>24&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Phoenix Mountain Ski Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>8000 Phoenix Ski Hill Rd, Greenwood, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>25&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Sasquatch Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>20955 Hemlock Valley Rd, Hemlock Valley, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>26&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Mount Baldy Ski Area&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>2680 Mount Baldy Rd, Bridesville, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>27&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Murray Ridge Ski Area&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>7904 Chalet Dr, Fort St James, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>28&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Fernie Alpine Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>5339 Fernie Ski Hill Rd, West Fernie, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>29&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Summit Lake Ski Area&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>2815 Hwy 6, Nakusp, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>30&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Purden Ski Village&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>3000 Purden Ski Hill Rd, Purden, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>31&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Manning Park&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>7500 Hwy 3, Manning Park West, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>32&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Revelstoke Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>2950 Camozzi Rd, Revelstoke, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>33&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Mt Timothy Ski Hill&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>318 Birch Pl, Forest Grove, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>34&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Sun Peaks Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>1280 Alpine Rd, Sun Peaks, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>35&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Harper Mountain&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>2580 Harper Mountain Rd, Paul Lake, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>36&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Silver Star Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>123 Shortt St, Vernon, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>37&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Kicking Horse Mountian Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>1500 Kicking Horse Trail, Golden, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>38&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>FACILITY_NAME&emsp;<\/b><\/td><td align='right'>Powder King Mountain Resort&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>MAILING_ADDRESS&emsp;<\/b><\/td><td align='right'>55581 Powder King Rd, Pine Pass, BC&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-128.95336359609,49.0692464520814,-114.938036290627,56.0097333775109,"Zoom to ski_resorts","<strong> ski_resorts <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"ski_resorts",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[49.0692464520814,56.0097333775109],"lng":[-128.95336359609,-114.938036290627]}},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      //map.on('click', function (e) {\n      //  var txt = document.querySelector('.lnlt').textContent;\n      //  console.log(txt);\n      //  //txt.innerText.focus();\n      //  //txt.select();\n      //  setClipboardText(txt);\n      //});\n\n      function setClipboardText(text){\n      var id = 'mycustom-clipboard-textarea-hidden-id';\n      var existsTextarea = document.getElementById(id);\n\n      if(!existsTextarea){\n      console.log('Creating textarea');\n      var textarea = document.createElement('textarea');\n      textarea.id = id;\n      // Place in top-left corner of screen regardless of scroll position.\n      textarea.style.position = 'fixed';\n      textarea.style.top = 0;\n      textarea.style.left = 0;\n\n      // Ensure it has a small width and height. Setting to 1px / 1em\n      // doesn't work as this gives a negative w/h on some browsers.\n      textarea.style.width = '1px';\n      textarea.style.height = '1px';\n\n      // We don't need padding, reducing the size if it does flash render.\n      textarea.style.padding = 0;\n\n      // Clean up any borders.\n      textarea.style.border = 'none';\n      textarea.style.outline = 'none';\n      textarea.style.boxShadow = 'none';\n\n      // Avoid flash of white box if rendered for any reason.\n      textarea.style.background = 'transparent';\n      document.querySelector('body').appendChild(textarea);\n      console.log('The textarea now exists :)');\n      existsTextarea = document.getElementById(id);\n      }else{\n      console.log('The textarea already exists :3')\n      }\n\n      existsTextarea.value = text;\n      existsTextarea.select();\n\n      try {\n      var status = document.execCommand('copy');\n      if(!status){\n      console.error('Cannot copy text');\n      }else{\n      console.log('The text is now on the clipboard');\n      }\n      } catch (err) {\n      console.log('Unable to copy.');\n      }\n      }\n\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>

---
class: inverse, middle, center
![size400](https://github.com/bcgov/bcmaps/raw/master/tools/readme/bcmaps-sticker.png)

---
class: bottom, right

background-image: url(img/bcmaps_readme.png)

## https://github.com/bcgov/bcmaps

???

on CRAN
---
## **bcmaps** layers

```r
# install.packages("bcmaps")
library(bcmaps)
available_layers()
```

&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;## &lt;span style='color: #555555;'&gt;# A tibble: 22 x 4&lt;/span&gt;&lt;span&gt;
##    layer_name   title                               shortcut_functi… local
##  &lt;/span&gt;&lt;span style='color: #555555;'&gt;*&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;chr&amp;gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;chr&amp;gt;&lt;/span&gt;&lt;span&gt;                               &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;lgl&amp;gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;lgl&amp;gt;&lt;/span&gt;&lt;span&gt;
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 1&lt;/span&gt;&lt;span&gt; airzones     British Columbia Air Zones          TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 2&lt;/span&gt;&lt;span&gt; bc_bound     BC Boundary                         TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 3&lt;/span&gt;&lt;span&gt; bc_bound_hr… BC Boundary - High Resolution       TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 4&lt;/span&gt;&lt;span&gt; bc_cities    BC Major Cities Points 1:2,000,000… TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 5&lt;/span&gt;&lt;span&gt; bc_neighbou… Boundary of British Columbia, prov… TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 6&lt;/span&gt;&lt;span&gt; ecoprovinces British Columbia Ecoprovinces       TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 7&lt;/span&gt;&lt;span&gt; ecoregions   British Columbia Ecoregions         TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 8&lt;/span&gt;&lt;span&gt; ecosections  British Columbia Ecosections        TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 9&lt;/span&gt;&lt;span&gt; gw_aquifers  British Columbia's developed groun… TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt;10&lt;/span&gt;&lt;span&gt; hydrozones   Hydrologic Zone Boundaries of Brit… TRUE             TRUE 
## &lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 12 more rows&lt;/span&gt;&lt;span&gt;
## 
## ------------------------
## Layers with a value of TRUE in the 'shortcut_function' column can be accessed
## with a function with the same name as the layer (e.g., `bc_bound()`),
## otherwise it needs to be accessed with the get_layer function.
## 
## Layers with a value of FALSE in the 'local' column are not stored in the
## bcmaps.rdata package but will be downloaded from the internet and cached
## on your hard drive.
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;

---

<div id="htmlwidget-e6b9986af676f6b1973d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e6b9986af676f6b1973d">{"x":{"filter":"none","fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],["airzones","bc_bound","bc_bound_hres","bc_cities","bc_neighbours","ecoprovinces","ecoregions","ecosections","gw_aquifers","hydrozones","municipalities","nr_areas","nr_districts","nr_regions","regional_districts","water_districts","water_precincts","watercourses_15M","watercourses_5M","wsc_drainages","bec","tsa"],["British Columbia Air Zones","BC Boundary","BC Boundary - High Resolution","BC Major Cities Points 1:2,000,000 (Digital Baseline Mapping)","Boundary of British Columbia, provinces/states and the portion of the Pacific Ocean that borders British Columbia","British Columbia Ecoprovinces","British Columbia Ecoregions","British Columbia Ecosections","British Columbia's developed ground water aquifers","Hydrologic Zone Boundaries of British Columbia","British Columbia Municipalities","British Columbia Natural Resource (NR) Areas","British Columbia Natural Resource (NR) Districts","British Columbia Natural Resource (NR) Regions","British Columbia Regional Districts","British Columbia's Water Management Districts","British Columbia's Water Management Precincts","British Columbia watercourses at 1:15M scale","British Columbia watercourses at 1:5M scale","Water Survey of Canada Sub-Sub-Drainage Areas","British Columbia BEC Map","B.C. Timber Supply Areas &amp; TSA Blocks"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>layer_name<\/th>\n      <th>title<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"lengthChange":false,"filter":false,"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>

???

- Each layer is available by calling the function of the same name

---

```r
bc &lt;- bc_bound()
ggplot() + 
*  geom_sf(data = bc, aes(fill = island)) 
```

&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;

---


```r
bc &lt;- bc_bound()
neighbours &lt;- bc_neighbours()
ggplot() + 
* geom_sf(data = neighbours)  +
* geom_sf(data = bc, aes(fill = island)) 
```

&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

---
## Something more interesting

Let's say we want to find the number of ski resorts in each natural 
resource region. Let's plot it first



.pull-left[

```r
nr_reg &lt;- nr_regions() %&gt;% 
  select(REGION_NAME)

ggplot() + 
  geom_sf(data = nr_reg, 
          aes(fill = REGION_NAME)) + 
  geom_sf(data = ski_resorts) + 
  theme(legend.position = "none")
```
]

.pull-right[
&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" /&gt;

]

---
## `sf::st_intersection()`

Intersect the ski resorts points with the polygons of natural resource 
regions to get the attributes of the underlying NR region for each point


```r
st_intersection(ski_resorts, nr_reg)
```

---
## `sf::st_intersection()`

Intersect the ski resorts points with the polygons of natural resource 
regions to get the attributes of the underlying NR region for each point


```r
st_intersection(ski_resorts, nr_reg)
```

```
## Error in geos_op2_geom("intersection", x, y): st_crs(x) == st_crs(y) is not TRUE
```
---
## Projections and Coordinate Reference Systems:
- Projections try to transform the earth from its spherical shape (3D) to a planar shape (2D) so that maps can be made on flat layers.

- A Coordinate reference system (CRS) defines how the two-dimensional, 
projected map is related to real locations on the earth using coordinates.


```r
st_crs(ski_resorts)
```

```
## Coordinate Reference System:
##   EPSG: 4326 
##   proj4string: "+proj=longlat +datum=WGS84 +no_defs"
```

```r
st_crs(nr_reg)
```

```
## Coordinate Reference System:
##   EPSG: 3005 
##   proj4string: "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
```

???

EPSG codes are very handy ways to refer to CRSs so we don't have to know those long meaningless strings
---
## `sf::st_transform()`


```r
*ski_resorts_bc_albers &lt;- st_transform(ski_resorts, 3005)
st_crs(ski_resorts_bc_albers, nr_reg)
```

```
## Coordinate Reference System:
##   EPSG: 3005 
##   proj4string: "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
```

---
## `bcmaps::transform_bc_albers()`


```r
*ski_resorts_bc_albers &lt;- transform_bc_albers(ski_resorts)
st_crs(ski_resorts_bc_albers, nr_reg)
```

```
## Coordinate Reference System:
##   EPSG: 3005 
##   proj4string: "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
```
---
## `sf::st_intersection()`


```r
resorts_reg &lt;- st_intersection(ski_resorts_bc_albers, nr_reg)
resorts_reg
```

&lt;PRE class="fansi fansi-output"&gt;&lt;CODE&gt;## Simple feature collection with 38 features and 3 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 809167.1 ymin: 463675.3 xmax: 1789497 ymax: 1230379
## epsg (SRID):    3005
## proj4string:    +proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs
## &lt;span style='color: #555555;'&gt;# A tibble: 38 x 4&lt;/span&gt;&lt;span&gt;
##    FACILITY_NAME  MAILING_ADDRESS   REGION_NAME                   geometry
##    &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;chr&amp;gt;&lt;/span&gt;&lt;span&gt;          &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;chr&amp;gt;&lt;/span&gt;&lt;span&gt;             &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;chr&amp;gt;&lt;/span&gt;&lt;span&gt;                      &lt;/span&gt;&lt;span style='color: #555555;font-style: italic;'&gt;&amp;lt;POINT [m]&amp;gt;&lt;/span&gt;&lt;span&gt;
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 1&lt;/span&gt;&lt;span&gt; Troll Resort   7271 Barkerville… Cariboo Natu…       (1271211 903164.3)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 2&lt;/span&gt;&lt;span&gt; Mt Timothy Sk… 318 Birch Pl, Fo… Cariboo Natu…       (1325236 776780.1)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 3&lt;/span&gt;&lt;span&gt; Kimberley Ski… Kimberley, BC     Kootenay-Bou…       (1719114 569979.2)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 4&lt;/span&gt;&lt;span&gt; Wapiti Ski Cl… 1000 Natal Rd, E… Kootenay-Bou…       (1789497 618005.4)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 5&lt;/span&gt;&lt;span&gt; Red Mountain … 4300 Red Mountai… Kootenay-Bou…       (1596715 488521.9)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 6&lt;/span&gt;&lt;span&gt; Salmo Ski Hill 499 Salmo Ski Hi… Kootenay-Bou…         (1633161 502288)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 7&lt;/span&gt;&lt;span&gt; Whitewater Sk… Whitewater Ski H… Kootenay-Bou…         (1640911 531982)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 8&lt;/span&gt;&lt;span&gt; Fairmont Hot … 5225 Fairmont Re… Kootenay-Bou…       (1721487 643404.5)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt; 9&lt;/span&gt;&lt;span&gt; Panorama Moun… 1921 Panorama Dr… Kootenay-Bou…       (1690637 652354.8)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt;10&lt;/span&gt;&lt;span&gt; Phoenix Mount… 8000 Phoenix Ski… Kootenay-Bou…       (1540949 483122.8)
## &lt;/span&gt;&lt;span style='color: #555555;'&gt;# ... with 28 more rows&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/CODE&gt;&lt;/PRE&gt;

---

```r
ggplot(resorts_reg, aes(x = REGION_NAME)) + 
  geom_bar() +
  coord_flip() + 
  labs(title = "Number of ski resorts in B.C. NR Regions")
```

&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-19-1.png" style="display: block; margin: auto;" /&gt;

---
We can go the other way to get the number of ski resorts into each 
NR region


```r
resorts_in_regions &lt;- st_contains(nr_reg, ski_resorts_bc_albers)
resorts_in_regions
```

```
## Sparse geometry binary predicate list of length 8, where the predicate was `contains'
##  1: 18, 33
##  2: 6, 8, 9, 11, 13, 19, 23, 24, 26, 28, ...
##  3: 15
##  4: 3, 27, 30, 38
##  5: 7, 21
##  6: 2, 4, 12, 14, 20, 25, 31
##  7: 1, 5, 10, 16, 34, 35, 36
##  8: 17, 22
```

---
Create a choropleth map showing the regions with the most ski resorts

```r
resorts_in_regions &lt;- st_covers(nr_reg, ski_resorts_bc_albers)
nr_reg$num_resorts &lt;- lengths(resorts_in_regions)
ggplot(nr_reg) + 
  geom_sf(aes(fill = num_resorts))
```

&lt;img src="bcmaps_bcgov_user2018_files/figure-html/unnamed-chunk-21-1.png" style="display: block; margin: auto;" /&gt;

---
exclude: true
### geometry generating logical operators

* `st_union`: union of several geometries
* `st_intersection`: intersection of pairs of geometries
* `st_difference`: difference between pairs of geometries
* `st_sym_difference`: symmetric difference (`xor`)

---
exclude: true
### logical binary geometry predicates

* `st_intersects`: touch or overlap
* `st_disjoint`: !intersects
* `st_touches`: touch
* `st_crosses`: cross (don't touch)
* `st_within`: within
* `st_contains`: contains
* `st_overlaps`: overlaps
* `st_covers`: cover
* `st_covered_by`: covered by
* `st_equals`: equals
* `st_equals_exact`: equals, with some fuzz

---
exclude: true
### higher-level operations: summarise, interpolate, aggregate, st_join

* `aggregate` and `summarise` use `st_union` (by default) to group feature geometries
* `st_interpolate_aw`: area-weighted interpolation, uses `st_intersection` to interpolate or redistribute attribute values, based on area of overlap:
* `st_join` uses one of the logical binary geometry predicates (default: `st_intersects`) to join records in table pairs

---
exclude: true
### manipulating geometries

* `st_line_merge`: merges lines
* `st_segmentize`: adds points to straight lines
* `st_voronoi`: creates voronoi tesselation
* `st_centroid`: gives centroid of geometry
* `st_convex_hull`: creates convex hull of set of points
* `st_triangulate`: triangulates set of points (not constrained)
* `st_polygonize`: creates polygon from lines that form a closed ring
* `st_simplify`: simplifies lines by removing vertices
* `st_split`: split a polygon given line geometry
* `st_buffer`: compute a buffer around this geometry/each geometry
* `st_make_valid`: tries to make an invalid geometry valid (requires lwgeom)
* `st_boundary`: return the boundary of a geometry

---
## Resources

.pull-left[
![](img/geocompr.png)
]

.pull-right[

https://geocompr.robinlovelace.net/

https://github.com/bcgov/bcmaps

http://r4ds.had.co.nz/

http://r-spatial.org/

]

.footnote[Source code for this presentation available [here](https://github.com/ateucher/vic-geogeeks-2018-01-30)

Made with [xaringan](https://slides.yihui.name/xaringan/)
]
---
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLanguage": "r",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
